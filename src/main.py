from fastapi import FastAPI, HTTPException, Depends
from pydantic import BaseModel
from sqlalchemy import create_engine, Integer, String, func, Boolean, not_
from sqlalchemy.orm import sessionmaker, mapped_column, Mapped, Session, DeclarativeBase
import uvicorn
import sys
import os
from dotenv import load_dotenv
import time
import sqlite3
import datetime
from fastapi.responses import FileResponse
from urllib.parse import quote
from fastapi.staticfiles import StaticFiles
import json
from fastapi import FastAPI, Response
from collections import defaultdict
from urllib.parse import urlparse, parse_qs

sys.path.append(os.path.dirname(__file__))

load_dotenv()

app = FastAPI()

PROD = os.getenv('PROD', '0') == '1'
SKIP_DB_CREATE = os.getenv('SKIP_DB_CREATE', '0') == '1'

# Database setup
DATABASE_FILEPATH = '/db/prod/label_work.db' if PROD else '/db/test/label_work.db'
engine = create_engine(f'sqlite://{DATABASE_FILEPATH}')
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

class Base(DeclarativeBase):
    pass

def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()


# TODO: probably need measurement link
class LabelTask(Base):
    __tablename__ = 'label_tasks'

    id: Mapped[int] = mapped_column(Integer, primary_key=True, index=True)
    fmc_id: Mapped[str] = mapped_column(String, index=True)
    measurement_checksum: Mapped[str] = mapped_column(String, unique=True, index=True)
    fmc_data: Mapped[str] = mapped_column(String)
    sia_meas_id_path: Mapped[str] = mapped_column(String)

    # 0 means not sent out yet
    sent_label_request_at_epoch: Mapped[int] = mapped_column(Integer, default=0)
    last_labeler: Mapped[str | None] = mapped_column(String, nullable=True, default=None)

    is_labeled: Mapped[bool] = mapped_column(Boolean, default=False)
    label_bolf_path: Mapped[str | None] = mapped_column(String, nullable=True, default=None)

    created_at_epoch: Mapped[int] = mapped_column(Integer)


class SkippedTaskCreate(BaseModel):
    sia_link: str
    skip_reason: str


class SkippedTask(Base):
    __tablename__ = 'skipped_tasks'
    id: Mapped[int] = mapped_column(Integer, primary_key=True, index=True)
    # raw content pasted into text field
    sia_link: Mapped[str] = mapped_column(String, index=True)
    skip_reason: Mapped[str] = mapped_column(String, index=True)
    measurement_checksum: Mapped[str | None] = mapped_column(String, index=True, nullable=True, default=None)


class Metric(Base):
    __tablename__ = 'metrics_history'

    id: Mapped[int] = mapped_column(Integer, primary_key=True, index=True)
    created_at_epoch: Mapped[int] = mapped_column(Integer)

    total_labelable: Mapped[int] = mapped_column(Integer)
    labeled: Mapped[int] = mapped_column(Integer)
    not_labeled: Mapped[int] = mapped_column(Integer)
    opened: Mapped[int] = mapped_column(Integer)
    opened_pending: Mapped[int] = mapped_column(Integer)


class LabelTaskCreate(BaseModel):
    fmc_id: str
    fmc_data: str
    measurement_checksum: str
    sia_meas_id_path: str


class LabeledTask(BaseModel):
    measurement_checksum: str
    label_bolf_path: str


@app.get('/api/get_task')
async def get_task(labeler_name: str, db: Session = Depends(get_db)):
    current_time_epoch = int(time.time())
    filter_backlisted = db.query(SkippedTask).filter(SkippedTask.measurement_checksum == LabelTask.measurement_checksum).exists()
    db_task = db.query(LabelTask).filter(LabelTask.is_labeled == False).filter(not_(filter_backlisted)).filter((current_time_epoch - 60 * 60 * 24 * 1) > LabelTask.sent_label_request_at_epoch).order_by(func.random()).first()
    if not db_task:
        return {'finished': True}

    db_task.last_labeler = labeler_name
    db_task.sent_label_request_at_epoch = current_time_epoch

    encoded_name = quote(labeler_name)

    sia_url = f'https://dev.sia.bosch-automotive-mlops.com/?time=0&minimalLabelMode=true&minimalLabelModeUsername={encoded_name}&measId={db_task.sia_meas_id_path}'

    db.commit()
    db.refresh(db_task)

    return {'task': db_task, 'sia_url': sia_url}


@app.get('/api/get_open_tasks')
async def get_open_tasks(db: Session = Depends(get_db)):
    current_time_epoch = int(time.time())
    filter_backlisted = db.query(SkippedTask).filter(SkippedTask.measurement_checksum == LabelTask.measurement_checksum).exists()
    return db.query(LabelTask).filter(LabelTask.is_labeled == False).filter(not_(filter_backlisted)).filter((current_time_epoch - 60 * 60 * 24 * 1) > LabelTask.sent_label_request_at_epoch).order_by(func.random()).all()


@app.get('/api/test_remove_realworld')
async def test_remove(db: Session = Depends(get_db)):
    db_tasks = db.query(LabelTask).all()

    cutoff_epoch = int(datetime.datetime.fromisoformat('2025-02-10T10:16:35.000Z'.replace('Z', '+00:00')).timestamp())

    ids_to_delete = []

    for task in db_tasks:
        fmc_data_dict = json.loads(task.fmc_data)
        if type(fmc_data_dict) != dict:
            continue
        if 'recordingDate' not in fmc_data_dict:
            continue
        recDate = fmc_data_dict['recordingDate']
        recEpoch = int(datetime.datetime.fromisoformat(recDate.replace('Z', '+00:00')).timestamp())
        if recEpoch > cutoff_epoch:
            ids_to_delete.append(task.id)
            print(recEpoch, cutoff_epoch)

    del_count = 0

    for id_val in ids_to_delete:
        row_to_delete = db.query(LabelTask).filter(LabelTask.id == id_val).first()
        if row_to_delete:
            db.delete(row_to_delete)
            del_count += 1
    
    db.commit()

    return {'del_count': del_count, 'sum': len(ids_to_delete)}



@app.post('/api/set_labeled')
async def set_labeled(tasks: list[LabeledTask], db: Session = Depends(get_db)):
    if not tasks:
        raise HTTPException(status_code=400, detail='No tasks provided')

    created_labeled_tasks = []

    for task in tasks:
        db_task = db.query(LabelTask).filter(LabelTask.measurement_checksum == task.measurement_checksum).first()
        if not db_task:
            print(f'Unknown task {task}')
            continue

        db_task.label_bolf_path = task.label_bolf_path
        db_task.is_labeled = True
        db.commit()

        created_labeled_tasks.append(task.model_dump())

    return created_labeled_tasks


@app.post('/api/add_tasks')
async def add_tasks(tasks: list[LabelTaskCreate], db: Session = Depends(get_db)):
    if not tasks:
        raise HTTPException(status_code=400, detail='No tasks provided')

    current_time = int(time.time())
    created_tasks = []

    for task in tasks:
        # TODO: check if fmc_data has correct data fields for later
        if not task.fmc_id or not task.fmc_data or not task.measurement_checksum:
            raise HTTPException(status_code=400, detail=f'Invalid Task {task}')

        db_task = db.query(LabelTask).filter(LabelTask.measurement_checksum == task.measurement_checksum).first()
        if db_task:
            print(f'Skipping Task {task}, already in db.')
            continue

        db_task = LabelTask(
            fmc_id=task.fmc_id,
            fmc_data=task.fmc_data,
            measurement_checksum=task.measurement_checksum,
            sia_meas_id_path=task.sia_meas_id_path,
            created_at_epoch=current_time
        )
        db.add(db_task)
        db.commit()
        created_tasks.append(task.model_dump())

    return {'created_tasks': created_tasks}


def checksum_from_sia_url(sia_link: str):
    try:
        return parse_qs(urlparse(sia_link).query)['measId'][0].split('/')[3]
    except Exception as e:
        print(f'Cannot get checksum for {sia_link}, {e}')
        return None

@app.post('/api/skip_task')
async def set_skipped(skipped_task: SkippedTaskCreate, db: Session = Depends(get_db)):
    if not skipped_task.sia_link:
        raise HTTPException(status_code=400, detail=f'Invalid sia_link {skipped_task.sia_link}')
    skip_task = SkippedTask(sia_link=skipped_task.sia_link, skip_reason=skipped_task.skip_reason, measurement_checksum=checksum_from_sia_url(skipped_task.sia_link))
    db.add(skip_task)
    db.commit()
    db.refresh(skip_task)
    return skip_task


@app.get('/api/backup_db')
async def backup_db():
    current_time = datetime.datetime.now().strftime('%Y_%m_%d_%H_%M_%S')
    if PROD:
        backup_path = f'/db/prod/backup/label_work_{current_time}.db'
    else:
        backup_path = f'/db/test/backup/label_work_{current_time}.db'

    source_con = sqlite3.connect(DATABASE_FILEPATH)
    backup_con = sqlite3.connect(backup_path)

    with backup_con:
        source_con.backup(backup_con)

    backup_con.close()
    source_con.close()


@app.get('/api/metrics')
async def get_metrics(db: Session = Depends(get_db)):
    total_count = db.query(LabelTask).count()
    labeled = db.query(LabelTask).filter(LabelTask.is_labeled == True).count()
    not_labeled = db.query(LabelTask).filter(LabelTask.is_labeled == False).count()
    opened = db.query(LabelTask).filter(LabelTask.sent_label_request_at_epoch != 0).count()

    metrics = {
        'total_labelable': total_count,
        'labeled': labeled,
        'not_labeled': not_labeled,
        'opened': opened,
        'opened_pending': opened - labeled
    }

    metric = Metric(**metrics, created_at_epoch=int(time.time()))
    db.add(metric)
    db.commit()

    return metrics


@app.get('/api/metrics_history')
async def get_metrics_history(db: Session = Depends(get_db)):
    return db.query(Metric).order_by(Metric.created_at_epoch).all()

@app.get('/api/leaderboard')
async def leaderboard(db: Session = Depends(get_db)):
    leaderboard_data = db.query(LabelTask.last_labeler, func.count()).filter(LabelTask.last_labeler != None).group_by(LabelTask.last_labeler).all()
    leaderboard = defaultdict(int)
    for labeler, count in leaderboard_data:
        leaderboard[labeler.lower()] += count
    
    sorted_leaderboard_items = sorted(leaderboard.items(), key=lambda item: item[1], reverse=True)
    top_20_items = sorted_leaderboard_items[:20]
    return {labeler: count for labeler, count in top_20_items}

@app.get('/api/roland_special')
async def roland_special(db: Session = Depends(get_db)):
    leaderboard_data = db.query(LabelTask.last_labeler, func.count()).filter(LabelTask.last_labeler != None).group_by(LabelTask.last_labeler).all()
    leaderboard = defaultdict(int)
    for labeler, count in leaderboard_data:
        leaderboard[labeler.lower()] += count
    
    sorted_leaderboard_items = sorted(leaderboard.items(), key=lambda item: item[1], reverse=True)
    return {labeler: count for labeler, count in sorted_leaderboard_items}

@app.get('/api/db_cleanup')
async def db_cleanup(db: Session = Depends(get_db)):
    valid_ids = ["265229", "265237", "362507", "362512", "362513", "362515", "362516", "362517", "362518", "362519", "362520", "362521", "362522", "362523", "362525", "362526", "362527", "362528", "362529", "362530", "362531", "362532", "362534", "362535", "362536", "362537", "362538", "362539", "362540", "362541", "362553", "362554", "362555", "362556", "362557", "362567", "362568", "362569", "362577", "362578", "362579", "362580", "362581", "362582", "362583", "362591", "362592", "362593", "362603", "362604", "362605", "362606", "362607", "362608", "362609", "362610", "362618", "362619", "362620", "362622", "362623", "362624", "362625", "362626", "362627", "362639", "362640", "362641", "362642", "362643", "362656", "362657", "362658", "362659", "362660", "362661", "362662", "362670", "362671", "362672", "362673", "362674", "362675", "362676", "362677", "362687", "362688", "362689", "362691", "362692", "362693", "362704", "362709", "362740", "362792", "362793", "362794", "362795", "362796", "362797", "362798", "362808", "362809", "362810", "362811", "362825", "362826", "362827", "362828", "362829", "362830", "362831", "362832", "362833", "362842", "362843", "362853", "362854", "362855", "362856", "362872", "362873", "362874", "362875", "362876", "362877", "362878", "362879", "362880", "362881", "362882", "362883", "362892", "362893", "362894", "362895", "362903", "362904", "362905", "362906", "362907", "362908", "362909", "362910", "362911", "362912", "362913", "362914", "362915", "362916", "362917", "362918", "362925", "362926", "362927", "362928", "362938", "362939", "362940", "362941", "362943", "362944", "362945", "362954", "362956", "362965", "362966", "362967", "362968", "362969", "362970", "362971", "362972", "362986", "362987", "362988", "362989", "362990", "362998", "362999", "363000", "363001", "363002", "363003", "363015", "363016", "363017", "363018", "363019", "363020", "363021", "363022", "363023", "363034", "363035", "363036", "363037", "363039", "363040", "363049", "363050", "363052", "363053", "363054", "363055", "363077", "363134", "363135", "363136", "363137", "363147", "363148", "363149", "363150", "363152", "363153", "363154", "363165", "363166", "363174", "363175", "363185", "363186", "363187", "363188", "363189", "363191", "363192", "363193", "363209", "363210", "363211", "363212", "363213", "363214", "363215", "363216", "363218", "363219", "363220", "363221", "363222", "363233", "363234", "363235", "363236", "363237", "363238", "363245", "363246", "363247", "363248", "363249", "363250", "363251", "363252", "363253", "363254", "363255", "363266", "363267", "363268", "363269", "363270", "363271", "363272", "363273", "363274", "363282", "363284", "363290", "363291", "363292", "363305", "363306", "363307", "363308", "363309", "363310", "363311", "363312", "363322", "363323", "363324", "363330", "363337", "363338", "364413", "364414", "364415", "364416", "364417", "364418", "364419", "364420", "364421", "364422", "364423", "364424", "364426", "364427", "364428", "364430", "364431", "364432", "364433", "364434", "364435", "364436", "364437", "364439", "364548", "364549", "364550", "364551", "364552", "364553", "364555", "364556", "364557", "364558", "364560", "364562", "364563", "364565", "364566", "364567", "364568", "364569", "364570", "364571", "364572", "364573", "364574", "364575", "364578", "364579", "364580", "364581", "364582", "364583", "364584", "364586", "364587", "364588", "364589", "364592", "364593", "364594", "364595", "364597", "364598", "364599", "364600", "364601", "364602", "364603", "364604", "364605", "364606", "364607", "364608", "364609", "364610", "364611", "364612", "364613", "364614", "364615", "364617", "364619", "364622", "364623", "364624", "364625", "364627", "364629", "364630", "364631", "364632", "364633", "364634", "364635", "364636", "364637", "364638", "364640", "364641", "364642", "364643", "364644", "364645", "364646", "364647", "364648", "364649", "364650", "364651", "364652", "364653", "364654", "364655", "364656", "364657", "364659", "364660", "364661", "364662", "364663", "364664", "364665", "364666", "364667", "364668", "364669", "364720", "364721", "364722", "364726", "364727", "364728", "364729", "364730", "364731", "364732", "364733", "364734", "364735", "364736", "364737", "364738", "364739", "364740", "364741", "364742", "364743", "364744", "364745", "364746", "364747", "364748", "364749", "364751", "364752", "364753", "364754", "364755", "364756", "364757", "364758", "364759", "364760", "364761", "364762", "364763", "364765", "364766", "364767", "364768", "364769", "364770", "364771", "364772", "364773", "364774", "364775", "364776", "364777", "364778", "364779", "364780", "364781", "364782", "364783", "364784", "364785", "364786", "364787", "364788", "364789", "364790", "364791", "364792", "364793", "364794", "364795", "364796", "364798", "364799", "364800", "364801", "364802", "364803", "364804", "364805", "364806", "364807", "364808", "364809", "364810", "364811", "364812", "364813", "364814", "364815", "364816", "364817", "364818", "364819", "364820", "364821", "364822", "364823", "364824", "364825", "364826", "364827", "364828", "364829", "364830", "364831", "364832", "364833", "364834", "364836", "364837", "364838", "364839", "364840", "364841", "364842", "364843", "364844", "364845", "364846", "364847", "364848", "364849", "364850", "364851", "364852", "364853", "364854", "364855", "364856", "364857", "364858", "364859", "364860", "364861", "364862", "364863", "364864", "364865", "364866", "364868", "364869", "364870", "364871", "364872", "364873", "364874", "364875", "364876", "364877", "364878", "364879", "364880", "364881", "364882", "364883", "364884", "364885", "364886", "364887", "364888", "364889", "364890", "364891", "364892", "364893", "364894", "364895", "364896", "364897", "364898", "364899", "364900", "364901", "364902", "364903", "364904", "364905", "364906", "364907", "364908", "364909", "364910", "364911", "364912", "364914", "364915", "364916", "364917", "364918", "364919", "364920", "364921", "364922", "364923", "364924", "364925", "364926", "364927", "364929", "364930", "364931", "364932", "364933", "364934", "364935", "364936", "364937", "364938", "364939", "364941", "364943", "364944", "364945", "364946", "364947", "364948", "364949", "364951", "364952", "364953", "364954", "364955", "364956", "364957", "364958", "364959", "364960", "364961", "364962", "364963", "364964", "364965", "364966", "364968", "364969", "364970", "364971", "364973", "364974", "364975", "364976", "364977", "364978", "364979", "364980", "364981", "364983", "364984", "364985", "364986", "364987", "364988", "364990", "364991", "364992", "364993", "364994", "364995", "364996", "364997", "364998", "364999", "365000", "365001", "365002", "365003", "365004", "365005", "365006", "365007", "365008", "365009", "365010", "365011", "365012", "365013", "365014", "365015", "365016", "365017", "365018", "365019", "365020", "365021", "365022", "365023", "365024", "365025", "365026", "365027", "365028", "365029", "365030", "365031", "365032", "365033", "365034", "365035", "365036", "365038", "365039", "365041", "365042", "365043", "365044", "365045", "365046", "365047", "365048", "365049", "365050", "365051", "365052", "365053", "365055", "365056", "365057", "365058", "365059", "365060", "365061", "365062", "365063", "365064", "365065", "365066", "365068", "365069", "365070", "365071", "365072", "365073", "365074", "365076", "365077", "365078", "365079", "365080", "365081", "365082", "365083", "365084", "365085", "365086", "365087", "365088", "365089", "365090", "365092", "365093", "365095", "365096", "365097", "365098", "365099", "365100", "365101", "365102", "365104", "365106", "365107", "365108", "365109", "365110", "365111", "365112", "365113", "365114", "365115", "365116", "365117", "365118", "365119", "365120", "365121", "365122", "365123", "365124", "365125", "365126", "365128", "365130", "365131", "365132", "365133", "365134", "365136", "365137", "365138", "365139", "365140", "365141", "365142", "365143", "365144", "365145", "365146", "365147", "365148", "365149", "365150", "365151", "365153", "365154", "365155", "365156", "365157", "365158", "365159", "365161", "365162", "365164", "365165", "365166", "365167", "365168", "365169", "365170", "365171", "365175", "365176", "365177", "365179", "365180", "365183", "365184", "365185", "365186", "365187", "365189", "365190", "365191", "365192", "365193", "365196", "365197", "365199", "365200", "365201", "365202", "365203", "365204", "365205", "365206", "365207", "365209", "365211", "365213", "370649", "370650", "370651", "370652", "370654", "370655", "370656", "370657", "370658", "370659", "370660", "370661", "370662", "370663", "370665", "370666", "370667", "370669", "370671", "370673", "370674", "370676", "370677", "370678", "370679", "370680", "370681", "370682", "370684", "370685", "370686", "370687", "370688", "370689", "370692", "370693", "370694", "370695", "370696", "370697", "370698", "370700", "370701", "370702", "370703", "370704", "370705", "370706", "370707", "370708", "370709", "370710", "370711", "370712", "370713", "370714", "370715", "370716", "370717", "370718", "370719", "370720", "370721", "370722", "370723", "370724", "370725", "370726", "370727", "370728", "370729", "370730", "370731", "370732", "370733", "370734", "370735", "370736", "370737", "370738", "370740", "370741", "370742", "370743", "370744", "370745", "370746", "370747", "370748", "370749", "370750", "370751", "370752", "370754", "370755", "370756", "370757", "370758", "370759", "370760", "370761", "370762", "370763", "370764", "370765", "370767", "370768", "370769", "370770", "370771", "370772", "370773", "370774", "370775", "370776", "370777", "370778", "370780", "370781", "370782", "370783", "370784", "370785", "370786", "370787", "370788", "370789", "370790", "370791", "370792", "370793", "370794", "370795", "370796", "370797", "370798", "370799", "370800", "370801", "370802", "370804", "370805", "370806", "370807", "370808", "370809", "370810", "370811", "370812", "370813", "370814", "370815", "370816", "370817", "370819", "370820", "370821", "370822", "370823", "370824", "370827", "370828", "370829", "370830", "370831", "370832", "370833", "370834", "370835", "370836", "370838", "370839", "370840", "370841", "370842", "370843", "370845", "370846", "370847", "370848", "370849", "370850", "370851", "370852", "370853", "370855", "370856", "370857", "370858", "370859", "370860", "370861", "370862", "370863", "370864", "370865", "370867", "370868", "370869", "370870", "370871", "370872", "370873", "370874", "370875", "370876", "370877", "370878", "370879", "370880", "370881", "370882", "370883", "370884", "370885", "370886", "370887", "370888", "370889", "370890", "370891", "370892", "370893", "370894", "370895", "370896", "370897", "370898", "370899", "370900", "370901", "370902", "370903", "370904", "370905", "370906", "370907", "370908", "370910", "370911", "370912", "370913", "370914", "370915", "370916", "370917", "370919", "370920", "370921", "370922", "370923", "370924", "370925", "370926", "370927", "370928", "370929", "370930", "370931", "370932", "370933", "370934", "370936", "370937", "370938", "370939", "370940", "370941", "370942", "370943", "370944", "370945", "370947", "370948", "370949", "370950", "370951", "370952", "370953", "370954", "370955", "370956", "370957", "370958", "370959", "370960", "370961", "370962", "370963", "370964", "370965", "370966", "370967", "370968", "370969", "370970", "370971", "370972", "370973", "370974", "370975", "370976", "370977", "370978", "370979", "370980", "370981", "370982", "370983", "370984", "370985", "370986", "370987", "370989", "370991", "370992", "370993", "370994", "370995", "370996", "370997", "370998", "370999", "371000", "371001", "371002", "371003", "371004", "371005", "371006", "371007", "371008", "371009", "371010", "371011", "371012", "371013", "371014", "371015", "371016", "371017", "371018", "371019", "371020", "371021", "371022", "371023", "371024", "371025", "371026", "371052", "371053", "371054", "371055", "371057", "371058", "371059", "371061", "371062", "371063", "371064", "371065", "371067", "371068", "371069", "371070", "371071", "371072", "371073", "371074", "371075", "371076", "371077", "371078", "371079", "371080", "371081", "371083", "371084", "371085", "371086", "371087", "371088", "371089", "371090", "371092", "371093", "371094", "371095", "371096", "371098", "371100", "371101", "371102", "371121", "371122", "371123", "371124", "371126", "371127", "371128", "371129", "371130", "371131", "371133", "371134", "371135", "371136", "371137", "371138", "371139", "371162", "371163", "371164", "371165", "371166", "371627", "371668", "371734", "371754", "371917", "371966", "371987", "372032", "372052", "372094", "372095", "372119", "372120", "372121", "372142", "372143", "372144", "372185", "372186", "372212", "372213", "372214", "372215", "372234", "372235", "372236", "372808", "372809", "372810", "372811", "372812", "372813", "372814", "372815", "372816", "372817", "372818", "372819", "372820", "372821", "372822", "372823", "372824", "372825", "372826", "372827", "372828", "372829", "372830", "372831", "372832", "372833", "372834", "372835", "372836", "372837", "372838", "372839", "372840", "372841", "372842", "372843", "372844", "372845", "372846", "372847", "372848", "372849", "372850", "372851", "372852", "372853", "372854", "372855", "372856", "372857", "372858", "372859", "372860", "372861", "372862", "372863", "372864", "372865", "372866", "372867", "372868", "372869", "372870", "372871", "372872", "372873", "372874", "372877", "372878", "372879", "372880", "372881", "372882", "372883", "372884", "372885", "372886", "372887", "372888", "372889", "372890", "372891", "372892", "372893", "372894", "372895", "372896", "372897", "372898", "372899", "372900", "372901", "372902", "372903", "372904", "372905", "372906", "372907", "372908", "372909", "372910", "372911", "372912", "372913", "372914", "372915", "372916", "372917", "372918", "372919", "372920", "372921", "372922", "372923", "372925", "372926", "372927", "372930", "372931", "372932", "372933", "372934", "372935", "372936", "372938", "372939", "372940", "372941", "372942", "372943", "372944", "372945", "372946", "372947", "372948", "372949", "372950", "372951", "372952", "372953", "372954", "372955", "372956", "372957", "372958", "372959", "372960", "372961", "372962", "372963", "372964", "372965", "372966", "372967", "372968", "372969", "372970", "372971", "372972", "372973", "372974", "372975", "372976", "372977", "372978", "372979", "372980", "372981", "372982", "372983", "372984", "372987", "372988", "372989", "372990", "372991", "372992", "372993", "372994", "372995", "372996", "372998", "372999", "373000", "373001", "373002", "373003", "373004", "373005", "373006", "373007", "373008", "373009", "373010", "373011", "373012", "373014", "373015", "373016", "373017", "373018", "373019", "373020", "373021", "373022", "373023", "373024", "373026", "373027", "373028", "373029", "373030", "373031", "373032", "373033", "373034", "373035", "373036", "373037", "373038", "373040", "373041", "373042", "373044", "373045", "373046", "373047", "373048", "373049", "373050", "373051", "373052", "373053", "373054", "373077", "373078", "373079", "373080", "373081", "373082", "373084", "373085", "373086", "373087", "373088", "373089", "373091", "373093", "373094", "373095", "373096", "373097", "373098", "373099", "373100", "373101", "373102", "373103", "373104", "373105", "373106", "373107", "373108", "373109", "373110", "373111", "373112", "373113", "373114", "373115", "373116", "373117", "373118", "373119", "373120", "373121", "373122", "373123", "373124", "373125", "373126", "373127", "373128", "373129", "373130", "373131", "373132", "373133", "373134", "373135", "373136", "373137", "373138", "373139", "373140", "373141", "373142", "373143", "373144", "373145", "373146", "373147", "373148", "373149", "373150", "373151", "373152", "373153", "373154", "373155", "373156", "373157", "373158", "373159", "373160", "373161", "373162", "373163", "373164", "373165", "373166", "373167", "373168", "373169", "373170", "373171", "373173", "373174", "373176", "373177", "373178", "373179", "373180", "373181", "373182", "373183", "373184", "373185", "373186", "373187", "373188", "373189", "373190", "373191", "373192", "373193", "373194", "373195", "373197", "373198", "373199", "373200", "373201", "373202", "373203", "373204", "373205", "373208", "373209", "373210", "373213", "373214", "373215", "373216", "373217", "373218", "373220", "373221", "373222", "373223", "373224", "373225", "373226", "373227", "373228", "373229", "373230", "373231", "373232", "373233", "373234", "373235", "373236", "373237", "373238", "373239", "373240", "373241", "373242", "373243", "373244", "373245", "373246", "373247", "373248", "373249", "373250", "373251", "373252", "373253", "373254", "373255", "373256", "373257", "373258", "373259", "373260", "373261", "373262", "373263", "373264", "373265", "373266", "373267", "373268", "373270", "373271", "373272", "373273", "373274", "373275", "373276", "373277", "373278", "373280", "373281", "373282", "373283", "373284", "373285", "373286", "373287", "373288", "373289", "373290", "373291", "373292", "373293", "373294", "373295", "373296", "373297", "373298", "373299", "373300", "373301", "373302", "373303", "373304", "373305", "373306", "373307", "373308", "373309", "373310", "373311", "373312", "373313", "373314", "373315", "373316", "373318", "373319", "373321", "373322", "373323", "373324", "373325", "373326", "373327", "373328", "373329", "373330", "373331", "373332", "373333", "373334", "373335", "373336", "373337", "373339", "373340", "373342", "373343", "373344", "373345", "373346", "373347", "373348", "373349", "373350", "373351", "373352", "373353", "373354", "373355", "373356", "373357", "373358", "373359", "373360", "373361", "373362", "373363", "373364", "373365", "373366", "373367", "373368", "373369", "373370", "373371", "373372", "373373", "373374", "373375", "373376", "373377", "373378", "373379", "373380", "373381", "373382", "373383", "373384", "373385", "373386", "373387", "373388", "373389", "373390", "373391", "373392", "373393", "373394", "373395", "373396", "373397", "373398", "373399", "373400", "373401", "373402", "373403", "373404", "373405", "373406", "373407", "373408", "373409", "373410", "373411", "373412", "373413", "373414", "373415", "373416", "373417", "373418", "373419", "373420", "373421", "373422", "373423", "373424", "373425", "373426", "373427", "373428", "373429", "373430", "373431", "373432", "373433", "373434", "373436", "373438", "373439", "373440", "373442", "373443", "373444", "373445", "373446", "373447", "373448", "373449", "373450", "373451", "373452", "373453", "373454", "373455", "373456", "373457", "373459", "373460", "373461", "373462", "373463", "373464", "373465", "373466", "373467", "373468", "373469", "373470", "373471", "373472", "373473", "373474", "373475", "373476", "373478", "373479", "373481", "373482", "373483", "373484", "373486", "373487", "373490", "373491", "373492", "373493", "373494", "373495", "373496", "373497", "373498", "373499", "373500", "373501", "373503", "373504", "373505", "373506", "373507", "373508", "373509", "373510", "373511", "373513", "373514", "373515", "373516", "373517", "373518", "373519", "373520", "373521", "373522", "373523", "373524", "373525", "373526", "373528", "373529", "373530", "373531", "373532", "373533", "373534", "373535", "373536", "373537", "373538", "373539", "373540", "373541", "373542", "373543", "373544", "373546", "373547", "373548", "373549", "373550", "373551", "373552", "373553", "373554", "373555", "373556", "373557", "373558", "373559", "373560", "373561", "373562", "373563", "373564", "373565", "373566", "373567", "373569", "373570", "373571", "373572", "373573", "373574", "373575", "373576", "373577", "373578", "373579", "373580", "373581", "373582", "373583", "373584", "373585", "373586", "373588", "373589", "373590", "373591", "373592", "373593", "373594", "373595", "373596", "373597", "373598", "373599", "373600", "373601", "373602", "373604", "373605", "373606", "373607", "373608", "373609", "373610", "373611", "373612", "373613", "373614", "373615", "373616", "373617", "373618", "373619", "373620", "373621", "373622", "373623", "373624", "373625", "373626", "373627", "373628", "373629", "373630", "373631", "373632", "373633", "373634", "373635", "373636", "373637", "373638", "373639", "373640", "373641", "373642", "373643", "373644", "373645", "373646", "373647", "373648", "373649", "373651", "373652", "373653", "373654", "373655", "373656", "373657", "373659", "373660", "373661", "373662", "373663", "373664", "373665", "373666", "373667", "373668", "373669", "373670", "373671", "373672", "373673", "373674", "373675", "373676", "373677", "373678", "373679", "373680", "373681", "373682", "373683", "373684", "373685", "373686", "373687", "373688", "373689", "373690", "373691", "373692", "373693", "373694", "373695", "373696", "373697", "373698", "373699", "373700", "373701", "373702", "373703", "373704", "373705", "373706", "373707", "373708", "373709", "373710", "373711", "373712", "373713", "373714", "373716", "373717", "373718", "373719", "373720", "373721", "373722", "373723", "373724", "373725", "373726", "373727", "373728", "373729", "373730", "373731", "373732", "373733", "373734", "373735", "373736", "373737", "373738", "373739", "373740", "373741", "373742", "373743", "373744", "373746", "373747", "373748", "373749", "373750", "373751", "373752", "373753", "373754", "373755", "373757", "373758", "373759", "373760", "373761", "373762", "373763", "373765", "373766", "373767", "373768", "373769", "373770", "373771", "373772", "373773", "373774", "373775", "373776", "373777", "373779", "373780", "373781", "373782", "373783", "373784", "373785", "373786", "373787", "373788", "373789", "373790", "373791", "373792", "373793", "373794", "373795", "373796", "373797", "373798", "373799", "373800", "373801", "373802", "373803", "373804", "373805", "373806", "373807", "373808", "373809", "373810", "373811", "373812", "373813", "373814", "373815", "373816", "373818", "373819", "373820", "373821", "373822", "373823", "373824", "373825", "373826", "373827", "373828", "373829", "373830", "373831", "373833", "373834", "373835", "373836", "373837", "373838", "373839", "373840", "373841", "373843", "373844", "373845", "373846", "373848", "373849", "373850", "373851", "373852", "373853", "373854", "373855", "373856", "373857", "373858", "373860", "373861", "373862", "373863", "373864", "373865", "373866", "373867", "373868", "373869", "373870", "373871", "373872", "373873", "373874", "373875", "373876", "373877", "373878", "373879", "373880", "373881", "373882", "373884", "373885", "373886", "373887", "373888", "373889", "373890", "373891", "373892", "373893", "373894", "373895", "373896", "373897", "373898", "373899", "373900", "373902", "373903", "373904", "373905", "373906", "373907", "373908", "373909", "373910", "373911", "373912", "373913", "373914", "373915", "373916", "373917", "373918", "373919", "373920", "373921", "373922", "373923", "373924", "373925", "373927", "373928", "373929", "373930", "373931", "373932", "373933", "373934", "373935", "373936", "373937", "373938", "373939", "373940", "373941", "373942", "373943", "373944", "373945", "373946", "373947", "373948", "373949", "373950", "373951", "373952", "373953", "373954", "373955", "373956", "373957", "373958", "373959", "373960", "373961", "373962", "373963", "373964", "373965", "373966", "373967", "373968", "373969", "373970", "373971", "373972", "373973", "373974", "373975", "373976", "373977", "373978", "373979", "373980", "373982", "373983", "373984", "373986", "373987", "373988", "373989", "373990", "373991", "373993", "373994", "373995", "373996", "373997", "373998", "374000", "374001", "374002", "374003", "374004", "374005", "374021", "374022", "374023", "374024", "374025", "374028", "374029", "374030", "374036", "374037", "374041", "374050", "374058", "374063", "374065", "374066", "374067", "374069", "374070", "374071", "374072", "374073", "374075", "374076", "374077", "374078", "374079", "374080", "374081", "374082", "374083", "374084", "374085", "374086", "374087", "374088", "374089", "374090", "374091", "374092", "374093", "374095", "374096", "374097", "374098", "374099", "374100", "374101", "374102", "374103", "374104", "374105", "374106", "374107", "374108", "374109", "374110", "374111", "374113", "374114", "374115", "374116", "374117", "374118", "374119", "374120", "374121", "374122", "374123", "374124", "374125", "374126", "374127", "374128", "374129", "374131", "374132", "374133", "374134", "374135", "374136", "374137", "374138", "374139", "374140", "374141", "374142", "374143", "374144", "374145", "374146", "374147", "374148", "374149", "374150", "374151", "374152", "374153", "374154", "374155", "374156", "374157", "374159", "374160", "374161", "374162", "374163", "374164", "374165", "374166", "374167", "374168", "374169", "374170", "374171", "374172", "374173", "374174", "374175", "374176", "374177", "374178", "374179", "374180", "374181", "374182", "374183", "374184", "374185", "374186", "374187", "374188", "374189", "374190", "374191", "374192", "374193", "374194", "374195", "374196", "374197", "374198", "374199", "374200", "374201", "374202", "374203", "374204", "374205", "374206", "374207", "374208", "374209", "374210", "374211", "374212", "374213", "374214", "374215", "374216", "374217", "374218", "374219", "374220", "374221", "374222", "374223", "374224", "374225", "374226", "374227", "374228", "374229", "374230", "374231", "374232", "374233", "374234", "374235", "374236", "374237", "374238", "374240", "374241", "374242", "374243", "374244", "374245", "374246", "374248", "374249", "374250", "374253", "374254", "374255", "374256", "374257", "374258", "374259", "374260", "374261", "374262", "374263", "374264", "374265", "374266", "374267", "374268", "374269", "374270", "374271", "374272", "374273", "374274", "374275", "374276", "374277", "374278", "374280", "374281", "374282", "374283", "374284", "374285", "374286", "374287", "374288", "374289", "374290", "374291", "374293", "374294", "374295", "374296", "374297", "374298", "374299", "374300", "374302", "374303", "374304", "374305", "374307", "374308", "374309", "374310", "374311", "374312", "374313", "374314", "374315", "374316", "374318", "374319", "374320", "374321", "374322", "374323", "374324", "374325", "374326", "374327", "374328", "374329", "374330", "374331", "374332", "374333", "374334", "374335", "374336", "374337", "374338", "374339", "374340", "374341", "374342", "374343", "374345", "374346", "374347", "374348", "374349", "374350", "374351", "374352", "374353", "374354", "374355", "374357", "374358", "374360", "374361", "374362", "374363", "374364", "374365", "374367", "374369", "374370", "374371", "374372", "374373", "374374", "374375", "374376", "374377", "374378", "374379", "374380", "374381", "374382", "374383", "374384", "374385", "374386", "374387", "374388", "374389", "374390", "374391", "374392", "374393", "374394", "374395", "374396", "374398", "374399", "374400", "374401", "374402", "374403", "374404", "374405", "374406", "374407", "374408", "374409", "374410", "374411", "374412", "374413", "374414", "374415", "374416", "374417", "374418", "374419", "374420", "374421", "374422", "374423", "374424", "374425", "374427", "374428", "374430", "374431", "374432", "374433", "374434", "374435", "374436", "374437", "374438", "374439", "374440", "374441", "374442", "374443", "374444", "374445", "374446", "374447", "374448", "374449", "374450", "374451", "374452", "374453", "374454", "374455", "374456", "374457", "374458", "374459", "374460", "374461", "374462", "374463", "374464", "374465", "374467", "374468", "374469", "374470", "374471", "374472", "374473", "374474", "374475", "374476", "374477", "374479", "374480", "374481", "374482", "374483", "374484", "374485", "374487", "374488", "374489", "374490", "374491", "374492", "374493", "374494", "374495", "374496", "374497", "374498", "374499", "374500", "374501", "374502", "374503", "374504", "374505", "374506", "374508", "374509", "374510", "374511", "374512", "374513", "374514", "374515", "374516", "374517", "374518", "374519", "374520", "374521", "374523", "374524", "374525", "374526", "374528", "374529", "374530", "374531", "374532", "374533", "374534", "374535", "374536", "374537", "374538", "374539", "374540", "374541", "374542", "374544", "374545", "374546", "374547", "374548", "374549", "374550", "374551", "374552", "374553", "374554", "374555", "374556", "374557", "374558", "374560", "374561", "374562", "374563", "374564", "374565", "374566", "374567", "374568", "374569", "374570", "374571", "374572", "374574", "374575", "374576", "374577", "374578", "374579", "374580", "374582", "374583", "374584", "374585", "374586", "374587", "374588", "374590", "374591", "374592", "374593", "374594", "374595", "374596", "374597", "374598", "374599", "374600", "374601", "374602", "374603", "374604", "374605", "374607", "374608", "374609", "374610", "374611", "374612", "374613", "374614", "374615", "374616", "374617", "374618", "374619", "374620", "374621", "374622", "374623", "374624", "374625", "374626", "374627", "374628", "374629", "374630", "374631", "374632", "374633", "374634", "374635", "374636", "374637", "374638", "374639", "374640", "374641", "374642", "374643", "374644", "374645", "374646", "374647", "374648", "374649", "374650", "374651", "374652", "374653", "374654", "374655", "374656", "374657", "374658", "374659", "374660", "374661", "374663", "374664", "374665", "374666", "374667", "374668", "374669", "374670", "374671", "374672", "374673", "374674", "374675", "374676", "374677", "374678", "374679", "374681", "374682", "374683", "374684", "374685", "374686", "374687", "374688", "374689", "374690", "374691", "374692", "374693", "374694", "374695", "374696", "374697", "374698", "374699", "374700", "374701", "374702", "374703", "374704", "374706", "374707", "374708", "374709", "374710", "374711", "374712", "374713", "374714", "374715", "374716", "374717", "374718", "374719", "374720", "374721", "374723", "374724", "374725", "374726", "374727", "374728", "374729", "374730", "374731", "374732", "374733", "374734", "374735", "374736", "374737", "374738", "374739", "374740", "374741", "374743", "374744", "374745", "374746", "374747", "374748", "374749", "374750", "374751", "374752", "374753", "374754", "374755", "374756", "374757", "374758", "374759", "374760", "374761", "374762", "374763", "374764", "374765", "374766", "374767", "374768", "374770", "374771", "374772", "374773", "374774", "374775", "374776", "374777", "374779", "374780", "374781", "374782", "374783", "374784", "374785", "374786", "374787", "374788", "374789", "374790", "374791", "374792", "374793", "374794", "374795", "374796", "374797", "374798", "374799", "374800", "374801", "374802", "374803", "374804", "374805", "374806", "374807", "374808", "374809", "374810", "374812", "374813", "374814", "374815", "374816", "374817", "374818", "374819", "374820", "374821", "374822", "374823", "374824", "374825", "374826", "374827", "374828", "374829", "374830", "374831", "374832", "374833", "374834", "374835", "374836", "374837", "374838", "374839", "374840", "374841", "374842", "374843", "374844", "374845", "374846", "374847", "374848", "374849", "374850", "374851", "374852", "374853", "374854", "374855", "374856", "374857", "374858", "374859", "374860", "374861", "374862", "374864", "374865", "374866", "374867", "374868", "374869", "374870", "374871", "374872", "374873", "374874", "374875", "374876", "374877", "374878", "374879", "374880", "374881", "374882", "374883", "374884", "374885", "374886", "374887", "374888", "374889", "374890", "374891", "374892", "374893", "374894", "374896", "374898", "374899", "374900", "374901", "374902", "374903", "374904", "374905", "374906", "374907", "374908", "374909", "374910", "374911", "374912", "374913", "374914", "374915", "374916", "374917", "374918", "374919", "374920", "374921", "374923", "374924", "374925", "374926", "374927", "374928", "374929", "374930", "374931", "374932", "374933", "374934", "374935", "374936", "374937", "374938", "374939", "374940", "374941", "374942", "374943", "374944", "374945", "374946", "374947", "374948", "374949", "374950", "374951", "374952", "374954", "374955", "374956", "374957", "374958", "374959", "374960", "374961", "374962", "374963", "374964", "374965", "374966", "374967", "374968", "374969", "374970", "374971", "374972", "374973", "374974", "374975", "374976", "374977", "374978", "374979", "374980", "374981", "374982", "374983", "374984", "374985", "374986", "374987", "374988", "374989", "374990", "374991", "374992", "374993", "374994", "374995", "374996", "374997", "374998", "374999", "375000", "375001", "375002", "375003", "375004", "375005", "375006", "375007", "375008", "375009", "375010", "375011", "375012", "375013", "375014", "375015", "375016", "375017", "375018", "375019", "375020", "375021", "375022", "375023", "375025", "375026", "375027", "375028", "375029", "375030", "375031", "375032", "375033", "375034", "375035", "375036", "375037", "375038", "375039", "375040", "375041", "375042", "375043", "375044", "375045", "375046", "375047", "375048", "375049", "375050", "375051", "375052", "375053", "375054", "375055", "375056", "375057", "375058", "375059", "375060", "375061", "375062", "375063", "375065", "375066", "375067", "375068", "375069", "375070", "375071", "375072", "375073", "375074", "375075", "375076", "375077", "375078", "375079", "375080", "375081", "375082", "375083", "375084", "375085", "375086", "375087", "375088", "375089", "375090", "375091", "375092", "375093", "375094", "375095", "375096", "375097", "375098", "375099", "375100", "375101", "375102", "375103", "375104", "375106", "375107", "375108", "375109", "375110", "375111", "375112", "375113", "375115", "375117", "375118", "375119", "375120", "375121", "375122", "375123", "375124", "375125", "375126", "375127", "375128", "375129", "375130", "375131", "375132", "375133", "375134", "375136", "375137", "375138", "375139", "375140", "375141", "375142", "375143", "375144", "375145", "375146", "375147", "375148", "375149", "375150", "375151", "375152", "375153", "375154", "375155", "375156", "375158", "375159", "375160", "375161", "375162", "375163", "375164", "375165", "375166", "375167", "375168", "375169", "375170", "375171", "375172", "375173", "375174", "375175", "375176", "375178", "375179", "375180", "375181", "375182", "375183", "375184", "375185", "375186", "375187", "375188", "375189", "375190", "375191", "375192", "375193", "375194", "375195", "375196", "375197", "375199", "375200", "375201", "375202", "375203", "375204", "375205", "375206", "375207", "375208", "375209", "375210", "375211", "375212", "375213", "375214", "375215", "375217", "375218", "375219", "375220", "375221", "375222", "375223", "375224", "375225", "375226", "375227", "375228", "375229", "375230", "375231", "375233", "375234", "375235", "375236", "375237", "375238", "375239", "375240", "375241", "375242", "375243", "375245", "375246", "375247", "375248", "375249", "375250", "375251", "375252", "375253", "375254", "375255", "375256", "375257", "375258", "375259", "375260", "375261", "375262", "375263", "375264", "375265", "375266", "375267", "375268", "375269", "375270", "375271", "375272", "375273", "375274", "375275", "375276", "375277", "375278", "375279", "375280", "375281", "375282", "375283", "375284", "375285", "375286", "375287", "375288", "375289", "375290", "375291", "375292", "375293", "375294", "375295", "375296", "375297", "375298", "375299", "375300", "375301", "375302", "375303", "375304", "375305", "375306", "375307", "375308", "375309", "375310", "375312", "375313", "375314", "375315", "375317", "375318", "375319", "375320", "375321", "375322", "375323", "375324", "375325", "375326", "375327", "375328", "375329", "375330", "375331", "375333", "375334", "375335", "375336", "375337", "375338", "375339", "375340", "375341", "375342", "375343", "375344", "375345", "375346", "375347", "375348", "375349", "375350", "375351", "375352", "375353", "375354", "375355", "375356", "375357", "375358", "375359", "375360", "375361", "375363", "375364", "375365", "375366", "375367", "375368", "375369", "375370", "375371", "375372", "375373", "375374", "375375", "375376", "375377", "375378", "375380", "375381", "375382", "375383", "375384", "375385", "375386", "375387", "375388", "375389", "375390", "375392", "375393", "375394", "375395", "375396", "375397", "375400", "375401", "375402", "375403", "375404", "375405", "375406", "375407", "375408", "375409", "375410", "375411", "375412", "375413", "375414", "375415", "375416", "375417", "375418", "375419", "375420", "375421", "375422", "375423", "375424", "375425", "375426", "375427", "375428", "375429", "375430", "375431", "375432", "375433", "375434", "375435", "375436", "375437", "375438", "375439", "375441", "375442", "375443", "375444", "375445", "375447", "375448", "375449", "375450", "375451", "375453", "375454", "375457", "375458", "375459", "375460", "375461", "375462", "375463", "375464", "375465", "375466", "375467", "375468", "375469", "375470", "375472", "375473", "375474", "375475", "375476", "375477", "375478", "375480", "375481", "375482", "375483", "375484", "375485", "375486", "375487", "375488", "375489", "375490", "375491", "375493", "375494", "375495", "375496", "375497", "375498", "375499", "375500", "375502", "375504", "375505", "375506", "375507", "375508", "375509", "375510", "375511", "375512", "375513", "375514", "375515", "375516", "375517", "375518", "375519", "375520", "375521", "375522", "375523", "375524", "375525", "375526", "375528", "375529", "375530", "375531", "375532", "375533", "375534", "375535", "375536", "375537", "375538", "375539", "375540", "375541", "375542", "375543", "375544", "375545", "375549", "375550", "375552", "375553", "375554", "375555", "375557", "375558", "375559", "375560", "375561", "375562", "375563", "375564", "375565", "375566", "375567", "375568", "375569", "375570", "375571", "375572", "375573", "375574", "375575", "375577", "375578", "375579", "375581", "375582", "375583", "375584", "375585", "375586", "375587", "375588", "375589", "375590", "375591", "375592", "375593", "375594", "375595", "375596", "375597", "375598", "375599", "375600", "375601", "375602", "375604", "375605", "375606", "375607", "375608", "375609", "375610", "375611", "375612", "375613", "375614", "375615", "375616", "375617", "375619", "375620", "375622", "375623", "375624", "375625", "375626", "375627", "375628", "375629", "375630", "375631", "375632", "375633", "375634", "375635", "375636", "375637", "375639", "375640", "375641", "375642", "375643", "375644", "375645", "375646", "375647", "375648", "375649", "375650", "375651", "375652", "375653", "375654", "375655", "375656", "375657", "375658", "375659", "375660", "375661", "375662", "375663", "375664", "375666", "375667", "375668", "375669", "375670", "375671", "375672", "375673", "375675", "375676", "375677", "375678", "375679", "375680", "375681", "375682", "375683", "375684", "375685", "375686", "375687", "375688", "375689", "375690", "375691", "375692", "375693", "375694", "375695", "375696", "375697", "375698", "375699", "375700", "375701", "375702", "375703", "375704", "375705", "375706", "375707", "375708", "375709", "375710", "375711", "375712", "375713", "375714", "375715", "375716", "375717", "375718", "375719", "375720", "375721", "375722", "375723", "375724", "375725", "375726", "375727", "375728", "375729", "375730", "375731", "375732", "375733", "375734", "375735", "375736", "375737", "375738", "375739", "375740", "375741", "375742", "375743", "375744", "375745", "375746", "375747", "375748", "375749", "375750", "375752", "375753", "375754", "375755", "375756", "375757", "375758", "375759", "375760", "375761", "375762", "375763", "375764", "375765", "375766", "375767", "375769", "375770", "375771", "375772", "375773", "375774", "375775", "375776", "375777", "375778", "375779", "375780", "375781", "375782", "375783", "375784", "375785", "375786", "375787", "375789", "375790", "375791", "375792", "375793", "375794", "375795", "375796", "375797", "375798", "375800", "375801", "375802", "375803", "375804", "375805", "375806", "375807", "375808", "375809", "375810", "375811", "375812", "375813", "375814", "375815", "375816", "375818", "375819", "375823", "375825", "375826", "375828", "375832", "375833", "375834", "375835", "375836", "375837", "375838", "375839", "375840", "375841", "375842", "375851", "375852", "375854", "375855", "375856", "375857", "375859", "375861", "375862", "375863", "375864", "375865", "375867", "375868", "375869", "375870", "375871", "375872", "375873", "375874", "375876", "375877", "375878", "375879", "375880", "375881", "375882", "375883", "375884", "375885", "375886", "375887", "375888", "375890", "375891", "375892", "375893", "375894", "375895", "375897", "375898", "375899", "375900", "375901", "375902", "375903", "375904", "375905", "375906", "375907", "375908", "375909", "375910", "375912", "375913", "375914", "375915", "375916", "375917", "375918", "375920", "375921", "375923", "375924", "375926", "375927", "375928", "375929", "375930", "375931", "375932", "375933", "375934", "375936", "375937", "375938", "375939", "375940", "375943", "375944", "375945", "375947", "375948", "375949", "375951", "375952", "375953", "375954", "375956", "375957", "375958", "375959", "375960", "375961", "375962", "375964", "375965", "375967", "375968", "375971", "375972", "375973", "375974", "375975", "375976", "375977", "375978", "375979", "375980", "375981", "375982", "375983", "375984", "375986", "375987", "375991", "375992", "375993", "375994", "375995", "375996", "375997", "375998", "375999", "376000", "376001", "376002", "376003", "376004", "376005", "376006", "376007", "376008", "376009", "376011", "376013", "376014", "376015", "376016", "376017", "376018", "376019", "376020", "376022", "376023", "376024", "376026", "376027", "376028", "376030", "376031", "376032", "376033", "376034", "376035", "376036", "376037", "376038", "376039", "376040", "376041", "376042", "376043", "376044", "376045", "376046", "376047", "376048", "376049", "376050", "376051", "376052", "376053", "376055", "376056", "376057", "376058", "376059", "376060", "376061", "376062", "376063", "376064", "376065", "376066", "376067", "376068", "376069", "376070", "376072", "376081", "376082", "376083", "376084", "376085", "376086", "376087", "376088", "376089", "376090", "376091", "376092", "376093", "376094", "376095", "376096", "376097", "376098", "376099", "376100", "376101", "376102", "376103", "376104", "376105", "376106", "376107", "376108", "376109", "376110", "376111", "376112", "376113", "376115", "376116", "376117", "376118", "376119", "376120", "376121", "376122", "376123", "376124", "376125", "376126", "376127", "376128", "376129", "376130", "376131", "376132", "376133", "376134", "376135", "376136", "376141", "376142", "376161", "376162", "376163", "376179", "376180", "376181", "376197", "376198", "376199", "376215", "376216", "376236", "376237", "376238", "376257", "376258", "376259", "376273", "376274", "376275", "376291", "376292", "376293", "376313", "376314", "376315", "376316", "376332", "376333", "376334", "376349", "376350", "376351", "376367", "376368", "376369", "376387", "376388", "378219", "378220", "378241", "378242", "378243", "378260", "378261", "378292", "378293", "378294", "378295", "378318", "378319", "378320", "378342", "378343", "378344", "378345", "378371", "378372", "378373", "378394", "378395", "378418", "378419", "378420", "378441", "378442", "378443", "378466", "378467", "378468", "378494", "378495", "378518", "378519", "378520", "378521", "378540", "378541", "378542", "378568", "378569", "378570", "378594", "379051", "379052", "379053", "379054", "379055", "379056", "379057", "379058", "379059", "379060", "379061", "379062", "379063", "379064", "379065", "379067", "379068", "379070", "379071", "379072", "379073", "379074", "379076", "379077", "379078", "379079", "379080", "379081", "379082", "379083", "379084", "379085", "379086", "379087", "379088", "379089", "379090", "379091", "379092", "379093", "379094", "379095", "379096", "379097", "379098", "379099", "379100", "379101", "379102", "379103", "379105", "379106", "379107", "379108", "379109", "379110", "379111", "379112", "379113", "379114", "379116", "379117", "379118", "379119", "379120", "379121", "379122", "379123", "379124", "379126", "379127", "379128", "379129", "379130", "379131", "379132", "379133", "379134", "379135", "379136", "379137", "379138", "379139", "379140", "379141", "379142", "379143", "379144", "379145", "379146", "379147", "379148", "379149", "379150", "379151", "379153", "379154", "379155", "379156", "379157", "379158", "379159", "379160", "379161", "379162", "379163", "379164", "379165", "379167", "379168", "379169", "379170", "379171", "379172", "379173", "379174", "379175", "379176", "379177", "379178", "379179", "379180", "379181", "379183", "379184", "379185", "379186", "379187", "379189", "379190", "379191", "379192", "379193", "379194", "379195", "379196", "379197", "383536", "383537", "383538", "383539", "383540", "383541", "383542", "383543", "383544", "383545", "383546", "383547", "383548", "383576", "383632", "383633", "383634", "383635", "383697", "383698", "383699", "383700", "383701", "383702", "383703", "383704", "383705", "383706", "383707", "383772", "383773", "383774", "383776", "383777", "383778", "383779", "383780", "383781", "383782", "383783", "383784", "383790", "383791", "383792", "383793", "383794", "383795", "383796", "383797", "383798", "383799", "383800", "383801", "383802", "383803", "383804", "383805", "383806", "383807", "383808", "383809", "383810", "383811", "383813", "383814", "383815", "383816", "383817", "383818", "383819", "383820", "383821", "383822", "383823", "383824", "383825", "383826", "383827", "383828", "383829", "383830", "383831", "383832", "383833", "383834", "383835", "383836", "383837", "383838", "383839", "383840", "383841", "383842", "383843", "383844", "383845", "383846", "383847", "383848", "383849", "383850", "383851", "383852", "383853", "383854", "383855", "383856", "383857", "383858", "383859", "383860", "383861", "383862", "383864", "383865", "383866", "383867", "383869", "383870", "383871", "383872", "383873", "383874", "383875", "383876", "383877", "383878", "383879", "383880", "383881", "383882", "383883", "383884", "383885", "383886", "383887", "383888", "383889", "383890", "383891", "383892", "383893", "383894", "383895", "383896", "383897", "383898", "383900", "383901", "383902", "383903", "383904", "383905", "383906", "383907", "383908", "383909", "383910", "383911", "383912", "383913", "383914", "383915", "383916", "383917", "383918", "383919", "383920", "383921", "383922", "383923", "383924", "383925", "383926", "383927", "383928", "383929", "383930", "383931", "383932", "383933", "383934", "383935", "383936", "383937", "383938", "383939", "383941", "383942", "383943", "383944", "383945", "383946", "383947", "383948", "383949", "383950", "383951", "383952", "383953", "383954", "383955", "383956", "383957", "383958", "383959", "383960", "383961", "383962", "383963", "383964", "383966", "383967", "383968", "383969", "383970", "383972", "383973", "383974", "383975", "383976", "383977", "383978", "383979", "383980", "383981", "383982", "383983", "383984", "383985", "383986", "383987", "383988", "383989", "383990", "383991", "383992", "383993", "383994", "383995", "383996", "383997", "383998", "383999", "384000", "384001", "384002", "384003", "384004", "384005", "384006", "384007", "384008", "384009", "384010", "384011", "384012", "384013", "384014", "384015", "384016", "384017", "384018", "384019", "384020", "384021", "384022", "384023", "384024", "384025", "384026", "384027", "384028", "384029", "384030", "384031", "384032", "384033", "384034", "384035", "384036", "384037", "384038", "384039", "384040", "384041", "384043", "384045", "384046", "384047", "384048", "384049", "384051", "384053", "384055", "384057", "384059", "384061", "384062", "384065", "384067", "384069", "384071", "384074", "384075", "384077", "384079", "384082", "384083", "384085", "384087", "384089", "384092", "384093", "384095", "384096", "384098", "384100", "384103", "384104", "384105", "384108", "384110", "384112", "384114", "384115", "384117", "384120", "384122", "384124", "384127", "384129", "384130", "384131", "384133", "384135", "384137", "384139", "384141", "384143", "384145", "384146", "384149", "384152", "384154", "384156", "384158", "384159", "384162", "384164", "384168", "384171", "384172", "384174", "384176", "384178", "384181", "384182", "384184", "384187", "384188", "384190", "384192", "384194", "384197", "384200", "384203", "384205", "384207", "384209", "384210", "384211", "384212", "384213", "384214", "384215", "384216", "384219", "384220", "384221", "384222", "384224", "384227", "384229", "384231", "384234", "384236", "384239", "384240", "384241", "384242", "384243", "384244", "384245", "384246", "384247", "384248", "384249", "384250", "384251", "384252", "384253", "384254", "384255", "384256", "384257", "384259", "384260", "384262", "384263", "384274", "384275", "384276", "384277", "384278", "384279", "384280", "384281", "384294", "384295", "384296", "384297", "384298", "384300", "384306", "384307", "384308", "384309", "384310", "384311", "384312", "384353", "384354", "384355", "384356", "384357", "384359", "384360", "384361", "384362", "384363", "384364", "384365", "384366", "384370", "384371", "384372", "384374", "384375", "384376", "384378", "384379", "384380", "384381", "384382", "384383", "384384", "384385", "384386", "384387", "384388", "384390", "384391", "384392", "384393", "384394", "384395", "384396", "384397", "384398", "384399", "384400", "384401", "384402", "384403", "384404", "384405", "384406", "384407", "384408", "384413", "384416", "384417", "384418", "384419", "384420", "384421", "384422", "384423", "384425", "384426", "384427", "384428", "384430", "384431", "384434", "384435", "384437", "384439", "384440", "384441", "384442", "384443", "384444", "384445", "384446", "384447", "384448", "384449", "384450", "384451", "384452", "384453", "384455", "384456", "384457", "384458", "384459", "384460", "384461", "384462", "384463", "384464", "384465", "384466", "384467", "384468", "384469", "384470", "384471", "384474", "384475", "384476", "384477", "384478", "384479", "384480", "384482", "384484", "384485", "384486", "384487", "384488", "384489", "384490", "384491", "384492", "384493", "384497", "384498", "384499", "384500", "384501", "384502", "384503", "384504", "384505", "384506", "384507", "384508", "384509", "384510", "384511", "384512", "384513", "384514", "384515", "384518", "384519", "384520", "384521", "384522", "384523", "384524", "384525", "384526", "384527", "384528", "384529", "384530", "384531", "384533", "384535", "384536", "384537", "384538", "384539", "384543", "384544", "384545", "384546", "384548", "384549", "384550", "384551", "384552", "384553", "384554", "384555", "384556", "384557", "384558", "384559", "384560", "384561", "384567", "384568", "384569", "384570", "384571", "384572", "384573", "384574", "384575", "384576", "384577", "384578", "384579", "384580", "384581", "384582", "384583", "384584", "384586", "384588", "384589", "384590", "384591", "384592", "384593", "384594", "384595", "384596", "384597", "384598", "384599", "384600", "384601", "384602", "384603", "384604", "384605", "384607", "384608", "384609", "384610", "384611", "384612", "384613", "384614", "384615", "384616", "384617", "384618", "384619", "384620", "384621", "384622", "384623", "384624", "384625", "384629", "384630", "384631", "384632", "384633", "384634", "384635", "384636", "384637", "384638", "384639", "384640", "384641", "384642", "384643", "384644", "384645", "384647", "384652", "384653", "384654", "384655", "384656", "384657", "384658", "384659", "384660", "384661", "384662", "384663", "384664", "384665", "384666", "384667", "384668", "384669", "384670", "384671", "384672", "384673", "384674", "384675", "384676", "384677", "384678", "384679", "384680", "384682", "384683", "384684", "384685", "384686", "384687", "384691", "384692", "384693", "384694", "384695", "384696", "384698", "384699", "384700", "384701", "384702", "384703", "384704", "384705", "384706", "384707", "384708", "384709", "384711", "384712", "384713", "384715", "384716", "384721", "384723", "384725", "384728", "384730", "384731", "384733", "384734", "384735", "384740", "384741", "384749", "384753", "384754", "384755", "384757", "384758", "384761", "384763", "384765", "384767", "384768", "384772", "384773", "384775", "384777", "384779", "384781", "384784", "386010", "386011", "386012", "386013", "386014", "386015", "386016", "386017", "386019", "386097", "386098", "386099", "386100", "386126", "386127", "386128", "386129", "386130", "386131", "386159", "386160", "386161", "386162", "386163", "386164", "386165", "386166", "386167", "386168", "386169", "386194", "386196", "386197", "386198", "386200", "386201", "386202", "386204", "386205", "386207", "386238", "386240", "386242", "386244", "386246", "386248", "386250", "386277", "386279", "386281", "386282", "386285", "386287", "386313", "386315", "386317", "386320", "386322", "386323", "386327", "386329", "386360", "386361", "386365", "386366", "386369", "386372", "386406", "386411", "386412", "386414", "386415", "386420", "386421", "386426", "386430", "386508", "386510", "386511", "386721", "386723", "386725", "386727", "386730", "386741", "386743", "386744", "386745", "386747", "386752", "386753", "386755", "386756", "386758", "386802", "386804", "386805", "386808", "386810", "386814", "386817", "386818", "386823", "386827", "386830", "386831", "386834", "386865", "386867", "386869", "386870", "386874", "386875", "386877", "386879", "386881", "386883", "386909", "386911", "386914", "386915", "386918", "386919", "386922", "386923", "386925", "386950", "386951", "386956", "386959", "386960", "386961", "386964", "386967", "386968", "387031", "387032", "387035", "387037", "387041", "387043", "387046", "387047", "387048", "387050", "387055", "387057", "387058", "387060", "387061", "387062", "387063", "387065", "387066", "387195", "387197", "387198", "387199", "387201", "387202", "387203", "387204", "387205", "387206", "387208", "387209", "387214", "387222", "387228", "387229", "387237", "387243", "387248", "387249", "387252", "387253", "387254", "387255", "387256", "387257", "387258", "387259", "387261", "387262", "387263", "387264", "387265", "387266", "387268", "387270", "387271", "387273", "387274", "387275", "387276", "387371", "387373", "387374", "387375", "387376", "387377", "387378", "387379", "387380", "387381", "387382", "387383", "387385", "387386", "387387", "387388", "387389", "387390", "387393", "387394", "387396", "387397", "387398", "387399", "387401", "387402", "387404", "387405", "387406", "387407", "387408", "387409", "387410", "387411", "387437", "387438", "387439", "387440", "387441", "387442", "387443", "387444", "387445", "387467", "387468", "387469", "387470", "387495", "387496", "387497", "387498", "387499", "387985", "387986", "387987", "387988", "387989", "387990", "388021", "388022", "388023", "388024", "388025", "388026", "388027", "388028", "388029", "388049", "388050", "388051", "388052", "388053", "388054", "388055", "388056", "388081", "388082", "388083", "388084", "388085", "388086", "388087", "388088", "388110", "388111", "388112", "388113", "388114", "388115", "388116", "388117", "388144", "388145", "388146", "388147", "388148", "388149", "388151", "388152", "388181", "388182", "388183", "388184", "388185", "388186", "388187", "388188", "388210", "388211", "388212", "388213", "388214", "388216", "388241", "388242", "388243", "388244", "388245", "388246", "388248", "388249", "388273", "388274", "388275", "388276", "388277", "388278", "388279", "388305", "388306", "388307", "388308", "388309", "388310", "388311", "388312", "388313", "388340", "388341", "388342", "388343", "388344", "388345", "388346", "388347", "388374", "388375", "388376", "388377", "388378", "388379", "388380", "388381", "388403", "388404", "388405", "388406", "388407", "388408", "388409", "388410", "388435", "388436", "388437", "388438", "388439", "388440", "388441", "388442", "388443", "388444", "388468", "388469", "388470", "388471", "388472", "388473", "388474", "388475", "388476", "388503", "388504", "388505", "388506", "388507", "388508", "388509", "388510", "388511", "388537", "388538", "388539", "388540", "388541", "388542", "388543", "388544", "388545", "388567", "388568", "388569", "388570", "388571", "388572", "388573", "388574", "388575", "388598", "388599", "388600", "388601", "388602", "388603", "388604", "388605", "388627", "388628", "388629", "388630", "388631", "388632", "388633", "388659", "388660", "388661", "388662", "388664", "388665", "388666", "388696", "388697", "388698", "388699", "388700", "388701", "388702", "388703", "388704", "388727", "388728", "388729", "388730", "388731", "388732", "388733", "388734", "388756", "388757", "388758", "388759", "388760", "389065", "389066", "389067", "389068", "389069", "389093", "389094", "389095", "389096", "389097", "389098", "389099", "389100", "389111", "389112", "389113", "389114", "389115", "389117", "389118", "389119", "389120", "389122", "389123", "389124", "389125", "389126", "389130", "389131", "389132", "389134", "389135", "389140", "389141", "389142", "389143", "389144", "389145", "389146", "389150", "389151", "389152", "389153", "389154", "389155", "389158", "389159", "389160", "389161", "389162", "389163", "389164", "389165", "389166", "389167", "389168", "389169", "389170", "389171", "389172", "389173", "389174", "389176", "389177", "389178", "389179", "389180", "389181", "389182", "389186", "389187", "389188", "389189", "389190", "389191", "389192", "389198", "389199", "389200", "389201", "389202", "389203", "389204", "389206", "389207", "389208", "389209", "389210", "389211", "389212", "389213", "389215", "389216", "389217", "389218", "389219", "389220", "389221", "389223", "389224", "389225", "389226", "389227", "389228", "389229", "389232", "389233", "389234", "389235", "389236", "389237", "389238", "389239", "389244", "389245", "389246", "389247", "389248", "389249", "389250", "389254", "389255", "389256", "389257", "389259", "389261", "389262", "389263", "389264", "389265", "389266", "389267", "389268", "389269", "389270", "389271", "389272", "389273", "389274", "389275", "389276", "389278", "389279", "389280", "389281", "389282", "389283", "389284", "389289", "389290", "389291", "389292", "389293", "389294", "389295", "389300", "389301", "389302", "389303", "389304", "389305", "389306", "389310", "389311", "389312", "389313", "389314", "389315", "389316", "389317", "389318", "389321", "389322", "389323", "389324", "389481", "389482", "389483", "389484", "389485", "389486", "389487", "389488", "389490", "389491", "389492", "389493", "389494", "389495", "389496", "389497", "389498", "389499", "389500", "389501", "389502", "389503", "389504", "389506", "389507", "389508", "389509", "389571", "389573", "389574", "389575", "389576", "389577", "389578", "389579", "389580", "389581", "389582", "389583", "389584", "389585", "389586", "389587", "389588", "389589", "389590", "389591", "389592", "389594", "389595", "389596", "389597", "389598", "389599", "389600", "389601", "389603", "389605", "389606", "389608"]
    rows_deleted = db.query(LabelTask).filter(
        ~LabelTask.fmc_id.in_(valid_ids)
    ).delete(synchronize_session=False)
    db.commit()
    print(f'Deleted', rows_deleted)

    remaining_rows = db.query(LabelTask).all()
    print('Remaining len', len(remaining_rows))
    print("Remaining rows:")
    for row in remaining_rows:
        if row.fmc_id not in valid_ids:
            print(f'Problem, {row.fmc_id} not valid but still in table')


@app.get('/')
async def get_index_html():
    return FileResponse('/static/index.html', headers={'Cache-Control': 'no-cache'})

@app.get('/leaderboard')
async def get_leaderboard_html():
    return FileResponse('/static/leaderboard.html', headers={'Cache-Control': 'no-cache'})

@app.get('/map')
async def get_map(labeler_name: str, level: int):
    level_to_map_id = max(0, min(level // 4, 6))
    return FileResponse(f'/static/img/stage{level_to_map_id}.png')

app.mount('/examples', StaticFiles(directory='/static/img/examples/'), name='examples')

if not SKIP_DB_CREATE:
    Base.metadata.create_all(engine)

# TODO: probably not needed
if __name__ == '__main__':
    uvicorn.run('main:app', host='0.0.0.0', port=7100, reload=True)
